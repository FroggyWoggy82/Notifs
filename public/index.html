<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Task Dashboard</title>
    <meta name="description" content="A simple PWA To-Do list with background notifications">
    <link rel="manifest" href="manifest.json">

    <!-- Optimized CSS Bundle - Single file replaces 60+ individual CSS files -->
    <link rel="stylesheet" href="css/bundle.css">

    <!-- Font Awesome for icons - External CDN for reliability -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Hide recurrence interval badges (×6, ×2, etc.) since tasks already have descriptive badges -->
    <link rel="stylesheet" href="css/utilities/hide-recurrence-interval-badges.css">

    <!-- Expanded task layout for more horizontal space -->
    <link rel="stylesheet" href="css/expanded-task-layout.css">

    <!-- Habit mobile indicators fix for responsive design -->
    <link rel="stylesheet" href="css/fixes/habit-mobile-indicators-fix.css">

    <!-- Mobile grocery badges optimization for better mobile fit -->
    <link rel="stylesheet" href="css/mobile-grocery-badges.css">

    <!-- Dynamic theme color for status bar - updated for dark theme -->
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192x192.png">

    <!-- Direct button fix -->
    <style>
        /* Ensure modal content doesn't overflow */
        .modal-content {
            overflow-x: hidden !important;
            max-width: 100% !important;
        }

        /* Subtask button styling */
        #addTaskModal .subtasks-header,
        #editTaskModal .subtasks-header {
            display: flex !important;
            align-items: center !important;
        }

        #addTaskModal #addSubtaskBtn,
        #editTaskModal #editAddSubtaskBtn {
            margin-left: 5px !important;
            height: auto !important;
            padding: 2px 6px !important;
            font-size: 0.75rem !important;
        }
    </style>
</head>
<body>
    <!-- Error handling script - runs before anything else -->
    <script>
        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error caught:', event.error || event.message);

            // Skip "Unexpected token '<'" errors which are usually from service worker issues
            // These are handled by the immediate-notification-fix.js script
            const errorMessage = event.error ? event.error.message : event.message;
            if (errorMessage && errorMessage.includes("Unexpected token '<'")) {
                console.warn("Ignoring 'Unexpected token <' error - likely a service worker issue that will be handled by immediate-notification-fix.js");
                return false;
            }

            // Log error to a visible element if the page is stuck
            const errorDiv = document.createElement('div');
            errorDiv.style.position = 'fixed';
            errorDiv.style.top = '10px';
            errorDiv.style.left = '10px';
            errorDiv.style.right = '10px';
            errorDiv.style.padding = '10px';
            errorDiv.style.backgroundColor = 'rgba(255, 0, 0, 0.8)';
            errorDiv.style.color = 'white';
            errorDiv.style.zIndex = '9999';
            errorDiv.style.borderRadius = '5px';
            errorDiv.textContent = 'Error: ' + errorMessage;
            document.body.appendChild(errorDiv);

            // Add buttons to handle service worker issues
            const buttonsDiv = document.createElement('div');
            buttonsDiv.style.marginTop = '10px';
            buttonsDiv.style.display = 'flex';
            buttonsDiv.style.gap = '10px';

            // Button to unregister service worker
            const unregisterButton = document.createElement('button');
            unregisterButton.textContent = 'Unregister Service Worker';
            unregisterButton.style.padding = '5px 10px';
            unregisterButton.style.backgroundColor = '#ff5722';
            unregisterButton.style.border = 'none';
            unregisterButton.style.borderRadius = '4px';
            unregisterButton.style.color = 'white';
            unregisterButton.style.cursor = 'pointer';
            unregisterButton.onclick = function() {
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(function(registrations) {
                        for(let registration of registrations) {
                            registration.unregister();
                        }
                        errorDiv.textContent = 'Service Worker unregistered. Reloading...';
                        setTimeout(() => window.location.reload(true), 1000);
                    });
                } else {
                    errorDiv.textContent = 'Service Worker API not available in this browser.';
                    setTimeout(() => window.location.reload(true), 1000);
                }
            };

            // Button to clear cache
            const clearCacheButton = document.createElement('button');
            clearCacheButton.textContent = 'Clear Cache';
            clearCacheButton.style.padding = '5px 10px';
            clearCacheButton.style.backgroundColor = '#2196f3';
            clearCacheButton.style.border = 'none';
            clearCacheButton.style.borderRadius = '4px';
            clearCacheButton.style.color = 'white';
            clearCacheButton.style.cursor = 'pointer';
            clearCacheButton.onclick = function() {
                if ('caches' in window) {
                    caches.keys().then(function(cacheNames) {
                        return Promise.all(
                            cacheNames.map(function(cacheName) {
                                return caches.delete(cacheName);
                            })
                        );
                    }).then(function() {
                        errorDiv.textContent = 'Cache cleared. Reloading...';
                        setTimeout(() => window.location.reload(true), 1000);
                    });
                } else {
                    errorDiv.textContent = 'Cache API not available in this browser.';
                    setTimeout(() => window.location.reload(true), 1000);
                }
            };

            // Button to bypass service worker
            const bypassButton = document.createElement('button');
            bypassButton.textContent = 'Bypass Service Worker';
            bypassButton.style.padding = '5px 10px';
            bypassButton.style.backgroundColor = '#4caf50';
            bypassButton.style.border = 'none';
            bypassButton.style.borderRadius = '4px';
            bypassButton.style.color = 'white';
            bypassButton.style.cursor = 'pointer';
            bypassButton.onclick = function() {
                window.location.href = '/?bypass=' + Date.now();
            };

            buttonsDiv.appendChild(unregisterButton);
            buttonsDiv.appendChild(clearCacheButton);
            buttonsDiv.appendChild(bypassButton);
            errorDiv.appendChild(document.createElement('br'));
            errorDiv.appendChild(buttonsDiv);

            return false;
        });

        // Set a timeout to detect if the page is stuck loading
        window.pageLoadTimeout = setTimeout(function() {
            // If this executes, the page has loaded but might be stuck
            if (document.readyState !== 'complete') {
                console.warn('Page load timeout reached but page is not complete');
                // Create a visible message
                const timeoutDiv = document.createElement('div');
                timeoutDiv.style.position = 'fixed';
                timeoutDiv.style.top = '10px';
                timeoutDiv.style.left = '10px';
                timeoutDiv.style.right = '10px';
                timeoutDiv.style.padding = '10px';
                timeoutDiv.style.backgroundColor = 'rgba(255, 165, 0, 0.8)';
                timeoutDiv.style.color = 'white';
                timeoutDiv.style.zIndex = '9999';
                timeoutDiv.style.borderRadius = '5px';
                timeoutDiv.innerHTML = 'Page is taking too long to load. <a href="/bypass" style="color:white;text-decoration:underline;">Click here to bypass service worker</a>';
                document.body.appendChild(timeoutDiv);
            }
        }, 10000); // 10 second timeout

        // Clear the timeout when the page finishes loading
        window.addEventListener('load', function() {
            clearTimeout(window.pageLoadTimeout);
            console.log('Page fully loaded');
        });
    </script>

    <!-- Critical scripts that must load immediately -->
    <script src="js/immediate-notification-fix.js"></script>
    <script src="js/notification-system.js"></script>
    <script src="js/modal-system.js"></script>
    <script src="js/tasks/script.js"></script>

    <!-- Non-critical scripts loaded asynchronously for better performance -->
    <script src="js/form-improvements.js" defer></script>
    <script src="js/common/sidebar.js" defer></script>
    <script src="js/common/status-bar.js" defer></script>
    <script src="js/common/clear-cache.js" defer></script>
    <script src="js/common/bottom-nav-fix.js" defer></script>
    <script src="js/common/bottom-nav-center-fix.js" defer></script>
    <script src="js/notification-permission-check.js" defer></script>
    <script src="js/dashboard-stats.js" defer></script>
    <script src="js/tasks/recurring-task-helper.js" defer></script>
    <script src="js/tasks/edit-modal-fix.js" defer></script>
    <script src="js/tasks/add-task-modal-fix.js" defer></script>
    <script src="js/tasks/task-action-hover-fix.js" defer></script>
    <script src="js/tasks/subtasks-support.js" defer></script>
    <script src="js/tasks/expand-button-fix.js" defer></script>
    <script src="js/tasks/task-icons-fix.js" defer></script>
    <script src="js/tasks/checkbox-redesign.js" defer></script>
    <script src="js/tasks/recurrence-indicator-redesign.js" defer></script>
    <script src="js/tasks/progress-photo-fix.js" defer></script>
    <script src="js/tasks/date-badge-redesign.js" defer></script>
    <script src="js/dropdown-arrow-toggle.js" defer></script>
    <script src="js/habits/habit-level-fix.js" defer></script>
    <script src="js/habits/habit-completion-fix.js" defer></script>
    <script src="js/habits/habit-icons-fix.js" defer></script>
    <script src="js/habits/high-completion-habit-fix.js" defer></script>
    <script src="js/habits/habit-reset.js" defer></script>
    <script src="js/habits/habit-modal-fix.js" defer></script>
    <script src="js/habits/habit-redesign.js" defer></script>
    <script src="js/habits/social-media-rejection-fix.js" defer></script>
    <script src="js/calendar/calendar-refresh-fix.js" defer></script>
    <script src="js/tasks/subtask-form-handler.js" defer></script>
    <script src="js/tasks/subtasks-fix-v4.js" defer></script>
    <script src="js/tasks/subtask-checkbox-fix.js" defer></script>
    <script src="js/tasks/subtask-button-fix.js" defer></script>
    <script src="js/tasks/grocery-task-display.js" defer></script>
    <script src="js/tasks/grocery-subtasks-unified.js" defer></script>
    <script src="js/tasks/overdue-recurrence-adjuster.js" defer></script>
    <script src="js/tasks/overdue-task-highlighter.js" defer></script>
    <script src="js/tasks/fix-duplicate-overdue-text.js" defer></script>
    <!-- <script src="js/standardized-date-indicators.js" defer></script> -->
    <script src="js/tasks/task-banners-right-alignment.js" defer></script>
    <script src="js/tasks/checkbox-click-fix.js" defer></script>
    <script src="js/food/form-field-fix.js" defer></script>
    <script src="js/tasks/subtask-display-fix.js" defer></script>
    <script src="js/tasks/subtask-debug.js" defer></script>
    <script src="js/tasks/subtask-dropdown-fix.js" defer></script>
    <script src="js/tasks/compact-modal-layout.js" defer></script>
    <script src="js/tasks/completed-tasks-simple-toggle.js" defer></script>

    <button class="menu-button">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Dashboard</h2>
        </div>
        <nav class="sidebar-nav">
            <a href="/index.html" class="sidebar-nav-item active">
                <span class="nav-icon"><i class="fas fa-check"></i></span>
                <span>Tasks</span>
            </a>
            <a href="/pages/goals.html" class="sidebar-nav-item">
                <span class="nav-icon"><i class="fas fa-star"></i></span>
                <span>Goals</span>
            </a>
            <a href="/pages/calendar.html" class="sidebar-nav-item">
                <span class="nav-icon"><i class="fas fa-calendar-alt"></i></span>
                <span>Calendar</span>
            </a>
            <a href="/pages/days-since.html" class="sidebar-nav-item">
                <span class="nav-icon"><i class="fas fa-stopwatch"></i></span>
                <span>Days Since</span>
            </a>
            <a href="/pages/food.html" class="sidebar-nav-item">
                <span class="nav-icon"><i class="fas fa-utensils"></i></span>
                <span>Food</span>
            </a>
            <a href="/pages/journal-redesign.html" class="sidebar-nav-item">
                <span class="nav-icon"><i class="fas fa-book"></i></span>
                <span>Journal</span>
            </a>
            <a href="/pages/product-tracking.html" class="sidebar-nav-item">
                <span class="nav-icon"><i class="fas fa-flask"></i></span>
                <span>Product Tracking</span>
            </a>
            <a href="/pages/settings.html" class="sidebar-nav-item">
                <span class="nav-icon"><i class="fas fa-cog"></i></span>
                <span>Settings</span>
            </a>
        </nav>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay"></div>

    <div class="container">
        <h1 class="gradient-text">My Tasks</h1>
        <div id="permissionStatus" class="notifications-status glass" style="display: none;">
            <i class="fas fa-bell"></i> Checking notification permission...
        </div>

        <!-- Status element with no inline styles -->
        <div id="status" class="status" data-auto-dismiss="true"></div>

        <!-- Dashboard section removed for a more compact UI -->

    <section class="task-list-section">
        <div class="card">
            <div class="card__header">
                <h2 class="card__title">Task List</h2>
                <div class="task-filter-container">
                    <select id="taskFilter" class="form-control form-control--glass">
                        <option value="unassigned_today" selected>Unassigned, Today & Overdue</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="all">All Tasks</option>
                    </select>
                </div>
            </div>
            <div class="card__body" style="padding-top: 0;">
                <div id="taskList">
                    <p>Loading tasks...</p>
                </div>
                <div id="taskListStatus" class="status"></div>
            </div>
        </div>
    </section>

    <!-- ===== Completed Tasks Section ===== -->
    <section class="completed-tasks-section">
        <div class="card">
            <div class="card__header">
                <h3 class="card__title collapsible-header" id="completedTasksHeader" style="margin-bottom: 0; cursor: pointer;">
                    Completed Tasks <i class="fas fa-chevron-down"></i>
                </h3>
            </div>
            <div class="card__body collapsible-content" id="completedTaskList" style="display: none !important; padding-top: 0;">
                <!-- Completed tasks will be dynamically added here -->
                <p>No completed tasks yet.</p>
            </div>
        </div>
    </section>
    <!-- ===== End Completed Tasks Section ===== -->

    <!-- ===== Habit List Section ===== -->
    <section class="habit-list-section">
        <div class="card card--habits">
            <div class="card__header">
                <h2 class="card__title" style="margin-bottom: 0;">Habit List</h2>
                <div class="card__actions">
                    <button id="addHabitBtn" class="btn btn--primary btn--sm btn--auto">
                        <i class="fas fa-plus"></i> New Habit
                    </button>
                </div>
            </div>
            <div class="card__body" style="padding: 0;">
                <div id="habitList" style="width: 100%; margin: 0; padding: 0;">
                    <p>Loading habits...</p> <!-- Placeholder -->
                </div>
                <div id="habitListStatus" class="status"></div>
            </div>
        </div>
    </section>
    <!-- ===== End Habit List Section ===== -->

    </div> <!-- End of container -->

    <div class="bottom-nav">
        <a href="/index.html" class="nav-item active" data-page="home-page">
            <div class="nav-icon"><i class="fas fa-check"></i></div>
            <span>Tasks</span>
        </a>
        <a href="/pages/goals.html" class="nav-item" data-page="goal-page">
            <div class="nav-icon"><i class="fas fa-star"></i></div>
            <span>Goals</span>
        </a>
        <a href="/pages/workouts.html" class="nav-item" data-page="workout-page">
            <div class="nav-icon"><i class="fas fa-dumbbell"></i></div>
            <span>Workouts</span>
        </a>
        <a href="/pages/calendar.html" class="nav-item" data-page="calendar-page">
            <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
            <span>Calendar</span>
        </a>
        <a href="/pages/food.html" class="nav-item" data-page="food-page">
            <div class="nav-icon"><i class="fas fa-utensils"></i></div>
            <span>Food</span>
        </a>
    </div>

    <!-- ===== Add Task Modal ===== -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <span class="close-button"><i class="fas fa-times"></i></span>
            <div class="modal-header">
                <h2>Add New Task</h2>
                <div class="modal-controls">
                    <div class="toggle-container">
                        <label class="toggle-switch" title="Use last task inputs">
                            <input type="checkbox" id="useLastInputs">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">Reuse last inputs</span>
                    </div>
                </div>
            </div>
            <form id="addTaskForm">
                <div class="form-group">
                    <label for="taskTitle" class="form-label">Title:</label>
                    <input type="text" id="taskTitle" class="form-control" placeholder="What needs to be done?" required>
                </div>
                <div class="form-group">
                    <label for="taskDescription" class="form-label">Description (Optional):</label>
                    <textarea id="taskDescription" class="form-control" placeholder="Add more details..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Reminders (Optional):</label>
                    <div class="reminder-checkboxes">
                        <div class="form-check">
                            <input type="checkbox" id="reminderSameDay" class="form-check-input reminder-checkbox" value="same-day">
                            <label for="reminderSameDay" class="form-check-label">On the due date</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="reminderDayBefore" class="form-check-input reminder-checkbox" value="day-before">
                            <label for="reminderDayBefore" class="form-check-label">1 day before</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="reminderWeekBefore" class="form-check-input reminder-checkbox" value="week-before">
                            <label for="reminderWeekBefore" class="form-check-label">1 week before</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="reminderCustom" class="form-check-input reminder-checkbox" value="custom">
                            <label for="reminderCustom" class="form-check-label">Custom time</label>
                        </div>
                    </div>
                </div>
                <div class="form-group" id="customReminderGroup" style="display: none;">
                    <label for="taskReminderTime" class="form-label">Custom Reminder Time:</label>
                    <input type="datetime-local" id="taskReminderTime" class="form-control">
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="taskDueDate" class="form-label">Due Date:</label>
                        <input type="date" id="taskDueDate" class="form-control">
                    </div>
                    <div class="form-group form-group-half">
                        <label for="taskDuration" class="form-label">Duration (days):</label>
                        <input type="number" id="taskDuration" class="form-control" min="1" value="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="taskRecurrenceType" class="form-label">Recurrence:</label>
                        <select id="taskRecurrenceType" class="form-control">
                            <option value="none" selected>None</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    <div class="form-group form-group-half" id="recurrenceIntervalGroup" style="display: none;">
                        <label for="taskRecurrenceInterval" class="form-label">Every:</label>
                        <div class="input-group">
                            <input type="number" id="taskRecurrenceInterval" class="form-control" value="1" min="1" step="1" style="width: 60px;">
                            <span id="recurrenceIntervalUnit" class="input-group-text">days</span>
                        </div>
                    </div>
                </div>

                <!-- Subtasks Section -->
                <div class="form-group">
                    <div class="subtasks-header">
                        <label class="form-label">Subtasks:</label>
                        <button type="button" id="addSubtaskBtn">Add Subtask</button>
                    </div>
                    <div id="subtasksList" class="subtasks-list">
                        <!-- Subtasks will be added here dynamically -->
                        <p class="no-subtasks-message">No subtasks added yet.</p>
                    </div>
                </div>

                <div class="button-container">
                    <button type="submit" id="addTaskBtn">Add Task</button>
                </div>
            </form>
            <div id="addTaskStatus" class="status"></div>
        </div>
    </div>
    <!-- ===== End Add Task Modal ===== -->

    <!-- ===== Add Task FAB ===== -->
    <button id="addTaskFab" class="fab" title="Add New Task" style="display: flex; pointer-events: auto;">
        <i class="fas fa-plus"></i>
    </button>

    <!-- ===== Edit Task Modal ===== -->
    <div id="editTaskModal" class="modal">
        <div class="modal-content">
            <span class="close-button"><i class="fas fa-times"></i></span>
            <div class="modal-header">
                <h2>Edit Task</h2>
            </div>
            <form id="editTaskForm">
                <input type="hidden" id="editTaskId"> <!-- Hidden field for ID -->
                <div class="form-group">
                    <label for="editTaskTitle" class="form-label">Title:</label>
                    <input type="text" id="editTaskTitle" class="form-control" placeholder="What needs to be done?" required>
                </div>
                <div class="form-group">
                    <label for="editTaskDescription" class="form-label">Description (Optional):</label>
                    <textarea id="editTaskDescription" class="form-control" placeholder="Add more details..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Reminders (Optional):</label>
                    <div class="reminder-checkboxes">
                        <div class="form-check">
                            <input type="checkbox" id="editReminderSameDay" class="form-check-input reminder-checkbox" value="same-day">
                            <label for="editReminderSameDay" class="form-check-label">On the due date</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="editReminderDayBefore" class="form-check-input reminder-checkbox" value="day-before">
                            <label for="editReminderDayBefore" class="form-check-label">1 day before</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="editReminderWeekBefore" class="form-check-input reminder-checkbox" value="week-before">
                            <label for="editReminderWeekBefore" class="form-check-label">1 week before</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" id="editReminderCustom" class="form-check-input reminder-checkbox" value="custom">
                            <label for="editReminderCustom" class="form-check-label">Custom time</label>
                        </div>
                    </div>
                </div>
                <div class="form-group" id="editCustomReminderGroup" style="display: none;">
                    <label for="editTaskReminderTime" class="form-label">Custom Reminder Time:</label>
                    <input type="datetime-local" id="editTaskReminderTime" class="form-control">
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="editTaskDueDate" class="form-label">Due Date:</label>
                        <input type="date" id="editTaskDueDate" class="form-control">
                    </div>
                    <div class="form-group form-group-half">
                        <label for="editTaskDuration" class="form-label">Duration (days):</label>
                        <input type="number" id="editTaskDuration" class="form-control" min="1" value="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="editTaskRecurrenceType" class="form-label">Recurrence:</label>
                        <select id="editTaskRecurrenceType" class="form-control">
                            <option value="none">None</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    <div class="form-group form-group-half" id="editRecurrenceIntervalGroup" style="display: none;">
                        <label for="editTaskRecurrenceInterval" class="form-label">Every:</label>
                        <div class="input-group">
                            <input type="number" id="editTaskRecurrenceInterval" class="form-control" value="1" min="1" step="1" style="width: 60px;">
                            <span id="editRecurrenceIntervalUnit" class="input-group-text">days</span>
                        </div>
                    </div>
                </div>

                <!-- Subtasks Section -->
                <div class="form-group">
                    <div class="subtasks-header">
                        <label class="form-label">Subtasks:</label>
                        <button type="button" id="editAddSubtaskBtn">Add Subtask</button>
                    </div>
                    <div id="editSubtasksList" class="subtasks-list">
                        <!-- Subtasks will be added here dynamically -->
                        <!-- We'll clear this completely before adding new subtasks -->
                    </div>
                </div>

                <!-- Subtasks fix is now handled by subtasks-fix.js -->

                <div class="button-container">
                    <button type="submit" id="saveTaskBtn">Save Changes</button>
                </div>
            </form>
            <div id="editTaskStatus" class="status"></div>
        </div>
    </div>
    <!-- ===== End Edit Task Modal ===== -->

    <!-- ===== Add Habit Modal ===== -->
    <div id="addHabitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Habit</h2>
                <div class="modal-controls">
                    <span class="close-button"><i class="fas fa-times"></i></span>
                </div>
            </div>
            <form id="addHabitForm">
                <div class="form-group">
                    <label for="habitTitle" class="form-label">Title:</label>
                    <input type="text" id="habitTitle" class="form-control" placeholder="What habit to build?" required>
                </div>
                <!-- Add description later if needed -->
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="habitRecurrenceType" class="form-label">Frequency:</label>
                        <select id="habitRecurrenceType" class="form-control">
                            <option value="daily" selected>Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <!-- Add specific days of week/month later -->
                        </select>
                    </div>
                    <div class="form-group form-group-half" id="habitCompletionsGroup">
                        <label for="habitCompletionsPerDay" class="form-label">Completions per Day:</label>
                        <input type="number" id="habitCompletionsPerDay" class="form-control" value="1" min="1" step="1">
                    </div>
                </div>
                <!-- Add goal/streak info later if needed -->
                <button type="submit" id="submitHabitBtn" class="btn btn--primary">
                    <i class="fas fa-plus-circle"></i> Add Habit
                </button>
            </form>
            <div id="addHabitStatus" class="status"></div>
        </div>
    </div>
    <!-- ===== End Add Habit Modal ===== -->

    <!-- ===== Edit Habit Modal ===== -->
    <div id="editHabitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Habit</h2>
                <div class="modal-controls">
                    <span class="close-button"><i class="fas fa-times"></i></span>
                </div>
            </div>
            <form id="editHabitForm">
                <input type="hidden" id="editHabitId"> <!-- Hidden field for ID -->
                <div class="form-group">
                    <label for="editHabitTitle" class="form-label">Title:</label>
                    <input type="text" id="editHabitTitle" class="form-control" placeholder="What habit to build?" required>
                </div>
                <div class="form-row">
                    <div class="form-group form-group-half">
                        <label for="editHabitRecurrenceType" class="form-label">Frequency:</label>
                        <select id="editHabitRecurrenceType" class="form-control">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    <div class="form-group form-group-half" id="editHabitCompletionsGroup">
                        <label for="editHabitCompletionsPerDay" class="form-label">Completions per Day:</label>
                        <input type="number" id="editHabitCompletionsPerDay" class="form-control" value="1" min="1" step="1">
                    </div>
                </div>
                <button type="submit" id="submitEditHabitBtn" class="btn btn--primary">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </form>
            <div id="editHabitStatus" class="status"></div>
        </div>
    </div>
    <!-- ===== End Edit Habit Modal ===== -->

    <!-- All JavaScript files are now loaded above with optimized async/defer loading -->
</body>
</html>
