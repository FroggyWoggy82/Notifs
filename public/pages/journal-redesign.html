<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#121212">
    <title>Journal</title>
    <link rel="stylesheet" href="../css/base/index.css">
    <link rel="stylesheet" href="../css/layout/sidebar.css">
    <link rel="stylesheet" href="../css/pages/journal-redesign.css">
    <link rel="stylesheet" href="../css/layout/bottom-nav-fix.css">
    <link rel="stylesheet" href="../css/white-checkbox-fill.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/utilities/task-icons-fix.css">
    <link rel="stylesheet" href="../css/utilities/recurrence-indicator-redesign.css">
    <link rel="stylesheet" href="../css/layout/bottom-nav-hover-animation.css">
    <link rel="stylesheet" href="../css/layout/bottom-nav-white-highlight.css">
    <link rel="stylesheet" href="../css/layout/bottom-nav-alignment-fix.css"> <!-- Fix for bottom nav alignment -->
    <link rel="stylesheet" href="../css/journal-bottom-nav-fix.css"> <!-- Custom fix for journal page bottom nav -->
    <link rel="stylesheet" href="../css/sidebar-style-fix.css">
    <link rel="manifest" href="../manifest.json">
    <link rel="icon" type="image/png" href="../icon-192x192.png">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
        </div>
        <a href="/" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-tasks"></i></div>
            <span>Tasks</span>
        </a>
        <a href="/pages/habits.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-sync-alt"></i></div>
            <span>Habits</span>
        </a>
        <a href="/pages/goals.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-bullseye"></i></div>
            <span>Goals</span>
        </a>
        <a href="/pages/days-since.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-calendar-day"></i></div>
            <span>Days Since</span>
        </a>
        <a href="/pages/workouts.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-dumbbell"></i></div>
            <span>Workouts</span>
        </a>
        <a href="/exercise-history" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
            <span>Exercise History</span>
        </a>
        <a href="/pages/calendar.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
            <span>Calendar</span>
        </a>
        <a href="/pages/food.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-utensils"></i></div>
            <span>Food</span>
        </a>
        <a href="/pages/journal-redesign.html" class="sidebar-nav-item active">
            <div class="nav-icon"><i class="fas fa-book"></i></div>
            <span>Journal</span>
        </a>
        <a href="/pages/settings.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-cog"></i></div>
            <span>Settings</span>
        </a>
    </div>
    <div class="sidebar-overlay"></div>

    <div class="main-content">
        <div class="top-bar">
            <button id="open-sidebar" class="menu-button">â˜°</button>
            <h1>Journal</h1>
        </div>

        <div class="journal-container">
            <!-- Controls section -->
            <div class="journal-controls">
                <div class="date-selector">
                    <label for="journal-date">Date:</label>
                    <input type="date" id="journal-date" value="">
                </div>
                <div class="journal-actions">
                    <div class="auto-save-status">
                        <span class="auto-save-text">Auto-saving enabled</span>
                    </div>
                </div>
            </div>

            <!-- Main chat interface -->
            <div class="journal-main">
                <!-- Chat messages area -->
                <div class="chat-container">
                    <div class="chat-header">
                        <h3>Conversation with Gibiti</h3>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="welcome-message">
                            <div class="message ai-message">
                                <div class="message-content">
                                    <p>Hello! I'm Gibiti, your AI journaling companion. Share your thoughts with me and I'll help you reflect and gain insights. What's on your mind today?</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat input area -->
                <div class="chat-input-area">
                    <div class="input-controls">
                        <div class="mood-selector">
                            <label for="mood-selector">Mood:</label>
                            <select id="mood-selector">
                                <option value="neutral">Neutral</option>
                                <option value="happy">Happy</option>
                                <option value="sad">Sad</option>
                                <option value="anxious">Anxious</option>
                                <option value="excited">Excited</option>
                                <option value="tired">Tired</option>
                                <option value="angry">Angry</option>
                            </select>
                        </div>
                        <div class="word-count" id="word-count">0 words</div>
                    </div>
                    <div class="input-wrapper">
                        <textarea id="journal-content" placeholder="Share your thoughts..." spellcheck="false"></textarea>
                        <button id="send-message" class="send-button" title="Send message">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- History section -->
            <div class="journal-history">
                <div class="history-header">
                    <h3 class="history-title">Recent Entries</h3>
                </div>
                <ul id="entry-list" class="entry-list">
                    <!-- Entries will be populated here -->
                    <li class="no-entries">No journal entries yet. Write your first entry and click "Save Entry".</li>
                </ul>
            </div>
        </div>

        <div id="status-message" class="status"></div>
    </div>

    <div class="bottom-nav">
        <a href="/index.html" class="nav-item" data-page="home-page">
            <div class="nav-icon"><i class="fas fa-check"></i></div>
            <span>Tasks</span>
        </a>
        <a href="/pages/goals.html" class="nav-item" data-page="goal-page">
            <div class="nav-icon"><i class="fas fa-star"></i></div>
            <span>Goals</span>
        </a>
        <a href="/pages/workouts.html" class="nav-item" data-page="workout-page">
            <div class="nav-icon"><i class="fas fa-dumbbell"></i></div>
            <span>Workouts</span>
        </a>
        <a href="/pages/calendar.html" class="nav-item" data-page="calendar-page">
            <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
            <span>Calendar</span>
        </a>
        <a href="/pages/food.html" class="nav-item" data-page="food-page">
            <div class="nav-icon"><i class="fas fa-utensils"></i></div>
            <span>Food</span>
        </a>
    </div>

    <!-- Common utilities -->
    <script src="../js/common/sidebar.js"></script>
    <script src="../js/common/sidebar-updater.js"></script>
    <script src="../js/common/status-bar.js"></script>

    <!-- Journal functionality -->
    <script src="../js/journal/journal-redesign.js"></script>
    <script src="../js/common/bottom-nav-fix.js"></script>
    <script src="../js/common/bottom-nav-center-fix.js"></script> <!-- Added for proper bottom nav alignment -->
    <script src="../js/tasks/task-icons-fix.js"></script>
    <script src="../js/tasks/checkbox-redesign.js"></script>
    <script src="../js/tasks/recurrence-indicator-redesign.js"></script>

    <!-- Set today's date immediately -->
    <script>
        // Set today's date as soon as the script runs
        (function() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}`;

            // Try to set the date immediately
            const dateInput = document.getElementById('journal-date');
            if (dateInput) {
                dateInput.value = formattedDate;
                console.log('Set date immediately:', formattedDate);
            }
        })();

        window.addEventListener('load', function() {
            // Word count functionality
            const wordCountElement = document.getElementById('word-count');
            const journalContentTextarea = document.getElementById('journal-content');

            if (wordCountElement && journalContentTextarea) {
                const text = journalContentTextarea.value;
                let wordCount = 0;

                if (text && text.trim().length > 0) {
                    const words = text.trim().split(/\s+/).filter(word => word.length > 0);
                    wordCount = words.length;
                }

                wordCountElement.textContent = `${wordCount} word${wordCount !== 1 ? 's' : ''}`;
                wordCountElement.style.color = 'white';
                wordCountElement.style.fontWeight = 'bold';

                // Add event listener for input events
                journalContentTextarea.addEventListener('input', function() {
                    const text = journalContentTextarea.value;
                    let wordCount = 0;

                    if (text && text.trim().length > 0) {
                        const words = text.trim().split(/\s+/).filter(word => word.length > 0);
                        wordCount = words.length;
                    }

                    wordCountElement.textContent = `${wordCount} word${wordCount !== 1 ? 's' : ''}`;
                });
            }

            // Bottom navigation is now handled by bottom-nav-center-fix.js
        });
    </script>
</body>
</html>
