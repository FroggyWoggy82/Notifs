<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#121212">
    <title>Journal</title>
    <link rel="stylesheet" href="../css/base/index.css">
    <link rel="stylesheet" href="../css/layout/sidebar.css">
    <link rel="stylesheet" href="../css/pages/journal-redesign.css">
    <link rel="stylesheet" href="../css/layout/bottom-nav-fix.css">
    <link rel="stylesheet" href="../css/white-checkbox-fill.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/utilities/task-icons-fix.css">
    <link rel="stylesheet" href="../css/utilities/recurrence-indicator-redesign.css">
    <link rel="stylesheet" href="../css/layout/bottom-nav-hover-animation.css">
    <link rel="stylesheet" href="../css/layout/bottom-nav-white-highlight.css">
    <link rel="stylesheet" href="../css/layout/bottom-nav-alignment-fix.css"> <!-- Fix for bottom nav alignment -->
    <link rel="stylesheet" href="../css/journal-bottom-nav-fix.css"> <!-- Custom fix for journal page bottom nav -->
    <link rel="stylesheet" href="../css/sidebar-style-fix.css">
    <link rel="manifest" href="../manifest.json">
    <link rel="icon" type="image/png" href="../icon-192x192.png">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Menu</h2>
        </div>
        <a href="/" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-tasks"></i></div>
            <span>Tasks</span>
        </a>
        <a href="/pages/habits.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-sync-alt"></i></div>
            <span>Habits</span>
        </a>
        <a href="/pages/goals.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-bullseye"></i></div>
            <span>Goals</span>
        </a>
        <a href="/pages/days-since.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-calendar-day"></i></div>
            <span>Days Since</span>
        </a>
        <a href="/pages/workouts.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-dumbbell"></i></div>
            <span>Workouts</span>
        </a>
        <a href="/exercise-history" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
            <span>Exercise History</span>
        </a>
        <a href="/pages/calendar.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
            <span>Calendar</span>
        </a>
        <a href="/pages/food.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-utensils"></i></div>
            <span>Food</span>
        </a>
        <a href="/pages/journal-redesign.html" class="sidebar-nav-item active">
            <div class="nav-icon"><i class="fas fa-book"></i></div>
            <span>Journal</span>
        </a>
        <a href="/pages/settings.html" class="sidebar-nav-item">
            <div class="nav-icon"><i class="fas fa-cog"></i></div>
            <span>Settings</span>
        </a>
    </div>
    <div class="sidebar-overlay"></div>

    <div class="main-content">
        <div class="top-bar">
            <button id="open-sidebar" class="menu-button">‚ò∞</button>
            <h1>Journal</h1>
            <div class="top-bar-actions">
                <button id="theme-toggle" class="icon-button" title="Toggle theme">
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </div>

        <div class="journal-container">
            <!-- Controls section -->
            <div class="journal-controls">
                <div class="date-selector">
                    <label for="journal-date">Date:</label>
                    <input type="date" id="journal-date">
                    <div id="sentiment-indicator" class="sentiment-indicator neutral" title="Entry sentiment">
                        <span class="sentiment-icon">üòê</span>
                    </div>
                </div>
                <div class="journal-actions">
                    <button id="save-entry" class="primary-button">
                        <i class="fas fa-save"></i> Save Entry
                    </button>
                    <button id="analyze-entry" class="secondary-button">
                        <i class="fas fa-brain"></i> Talk to AI Therapist
                    </button>
                    <button id="test-ollama" class="secondary-button">
                        <i class="fas fa-server"></i> Test Ollama
                    </button>
                    <a href="/pages/journal.html" class="secondary-button" style="text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
                        <i class="fas fa-undo"></i> Classic View
                    </a>
                </div>
            </div>

            <!-- Editor section -->
            <div class="journal-editor">
                <div class="editor-header">
                    <h3 class="editor-title">Write Your Journal</h3>
                    <div class="editor-tools">
                        <button id="voice-to-text" class="tool-button" title="Voice to text">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                </div>
                <textarea id="journal-content" placeholder="Start writing your thoughts here..." spellcheck="false"></textarea>
                <div class="editor-footer">
                    <div class="word-count" id="word-count" style="color: white; font-weight: bold;">0 words</div>
                    <div class="mood-selector">
                        <label for="mood-selector">Mood:</label>
                        <select id="mood-selector">
                            <option value="neutral">Neutral</option>
                            <option value="happy">Happy</option>
                            <option value="sad">Sad</option>
                            <option value="anxious">Anxious</option>
                            <option value="excited">Excited</option>
                            <option value="tired">Tired</option>
                            <option value="angry">Angry</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- AI Assistant section -->
            <div class="ai-assistant">
                <div class="assistant-header">
                    <h3 class="assistant-title">
                        <i class="fas fa-robot"></i> AI Assistant
                    </h3>
                    <div class="assistant-tools">
                        <button id="save-insights" class="tool-button" title="Save insights">
                            <i class="fas fa-bookmark"></i>
                        </button>
                    </div>
                </div>
                <div class="assistant-content" id="analysis-content">
                    <p class="placeholder">Your AI assistant will provide insights, questions, and feedback as you write.</p>
                </div>
                <div class="assistant-footer">
                    <h4>Suggested prompts:</h4>
                    <div class="prompt-suggestions" id="prompt-suggestions">
                        <div class="prompt-suggestion">How are you feeling today?</div>
                        <div class="prompt-suggestion">What's on your mind?</div>
                        <div class="prompt-suggestion">What are you grateful for?</div>
                    </div>
                </div>
            </div>

            <!-- History section -->
            <div class="journal-history">
                <div class="history-header">
                    <h3 class="history-title">Recent Entries</h3>
                </div>
                <ul id="entry-list" class="entry-list">
                    <!-- Entries will be populated here -->
                    <li class="no-entries">No journal entries yet. Write your first entry and click "Save Entry".</li>
                </ul>
            </div>
        </div>

        <div id="status-message" class="status"></div>
    </div>

    <div class="bottom-nav">
        <a href="/index.html" class="nav-item" data-page="home-page">
            <div class="nav-icon"><i class="fas fa-check"></i></div>
            <span>Tasks</span>
        </a>
        <a href="/pages/goals.html" class="nav-item" data-page="goal-page">
            <div class="nav-icon"><i class="fas fa-star"></i></div>
            <span>Goals</span>
        </a>
        <a href="/pages/workouts.html" class="nav-item" data-page="workout-page">
            <div class="nav-icon"><i class="fas fa-dumbbell"></i></div>
            <span>Workouts</span>
        </a>
        <a href="/pages/calendar.html" class="nav-item" data-page="calendar-page">
            <div class="nav-icon"><i class="fas fa-calendar-alt"></i></div>
            <span>Calendar</span>
        </a>
        <a href="/pages/food.html" class="nav-item" data-page="food-page">
            <div class="nav-icon"><i class="fas fa-utensils"></i></div>
            <span>Food</span>
        </a>
    </div>

    <!-- Common utilities -->
    <script src="../js/common/sidebar.js"></script>
    <script src="../js/common/sidebar-updater.js"></script>
    <script src="../js/common/status-bar.js"></script>

    <!-- Journal functionality -->
    <script src="../js/journal/journal-redesign.js"></script>
    <script src="../js/common/bottom-nav-fix.js"></script>
    <script src="../js/common/bottom-nav-center-fix.js"></script> <!-- Added for proper bottom nav alignment -->
    <script src="../js/tasks/task-icons-fix.js"></script>
    <script src="../js/tasks/checkbox-redesign.js"></script>
    <script src="../js/tasks/recurrence-indicator-redesign.js"></script>

    <!-- Force word count update on page load -->
    <script>
        window.addEventListener('load', function() {
            // Word count functionality
            const wordCountElement = document.getElementById('word-count');
            const journalContentTextarea = document.getElementById('journal-content');

            if (wordCountElement && journalContentTextarea) {
                const text = journalContentTextarea.value;
                let wordCount = 0;

                if (text && text.trim().length > 0) {
                    const words = text.trim().split(/\s+/).filter(word => word.length > 0);
                    wordCount = words.length;
                }

                wordCountElement.textContent = `${wordCount} word${wordCount !== 1 ? 's' : ''}`;
                wordCountElement.style.color = 'white';
                wordCountElement.style.fontWeight = 'bold';

                // Add event listener for input events
                journalContentTextarea.addEventListener('input', function() {
                    const text = journalContentTextarea.value;
                    let wordCount = 0;

                    if (text && text.trim().length > 0) {
                        const words = text.trim().split(/\s+/).filter(word => word.length > 0);
                        wordCount = words.length;
                    }

                    wordCountElement.textContent = `${wordCount} word${wordCount !== 1 ? 's' : ''}`;
                });
            }

            // Bottom navigation is now handled by bottom-nav-center-fix.js
        });
    </script>
</body>
</html>
