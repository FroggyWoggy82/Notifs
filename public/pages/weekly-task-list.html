<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Task List - Complete Overview</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .week-selector {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .summary {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .summary-number {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .summary-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #eee;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
        }
        .tab.active {
            background: #667eea;
            color: white;
        }
        .tab-content {
            padding: 20px;
            min-height: 400px;
        }
        .day-section {
            margin-bottom: 30px;
        }
        .day-header {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #667eea;
        }
        .task-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .task-item.completed {
            opacity: 0.7;
            background: #e8f5e8;
        }
        .task-checkbox {
            width: 18px;
            height: 18px;
        }
        .task-content {
            flex: 1;
        }
        .task-title {
            font-weight: 500;
            color: #333;
        }
        .task-meta {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        .notification-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .notification-time {
            font-weight: bold;
            color: #856404;
            margin-bottom: 8px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Weekly Task List - Complete Overview</h1>
            <p>All tasks organized by day and notification</p>
        </div>

        <div class="week-selector">
            <label for="weekStart">Week starting:</label>
            <input type="date" id="weekStart" />
            <button onclick="loadWeeklyData()">Load Week</button>
            <button onclick="loadCurrentWeek()">Current Week</button>
        </div>

        <div class="summary" id="summary">
            <!-- Summary will be populated here -->
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('daily')">Daily View</button>
            <button class="tab" onclick="showTab('notifications')">Notifications</button>
        </div>

        <div class="tab-content">
            <div id="daily-content">
                <div class="loading">Loading daily tasks...</div>
            </div>
            <div id="notifications-content" style="display: none;">
                <div class="loading">Loading notifications...</div>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;
        let activeTab = 'daily';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentWeek();
        });

        function loadCurrentWeek() {
            // Set date input to current week's Sunday
            const now = new Date();
            const sunday = new Date(now);
            sunday.setDate(now.getDate() - now.getDay());
            document.getElementById('weekStart').value = sunday.toISOString().split('T')[0];
            loadWeeklyData();
        }

        async function loadWeeklyData() {
            const startDate = document.getElementById('weekStart').value;
            const url = startDate ? 
                `/api/tasks/weekly-complete-list?startDate=${startDate}` : 
                '/api/tasks/weekly-complete-list';

            try {
                showLoading();
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                currentData = await response.json();
                renderSummary();
                renderContent();
                
            } catch (error) {
                showError('Failed to load weekly data: ' + error.message);
            }
        }

        function showLoading() {
            document.getElementById('daily-content').innerHTML = '<div class="loading">Loading daily tasks...</div>';
            document.getElementById('notifications-content').innerHTML = '<div class="loading">Loading notifications...</div>';
            document.getElementById('summary').innerHTML = '<div class="loading">Loading summary...</div>';
        }

        function showError(message) {
            const errorHtml = `<div class="error">${message}</div>`;
            document.getElementById('daily-content').innerHTML = errorHtml;
            document.getElementById('notifications-content').innerHTML = errorHtml;
            document.getElementById('summary').innerHTML = errorHtml;
        }

        function renderSummary() {
            if (!currentData) return;
            
            const summary = currentData.summary;
            const summaryHtml = `
                <h3>Week of ${currentData.weekStart} to ${currentData.weekEnd}</h3>
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-number">${summary.totalTasks}</div>
                        <div class="summary-label">Total Tasks</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${summary.completedTasks}</div>
                        <div class="summary-label">Completed</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${summary.pendingTasks}</div>
                        <div class="summary-label">Pending</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${summary.completionRate}%</div>
                        <div class="summary-label">Completion Rate</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${summary.tasksWithNotifications}</div>
                        <div class="summary-label">With Notifications</div>
                    </div>
                </div>
            `;
            
            document.getElementById('summary').innerHTML = summaryHtml;
        }

        function renderContent() {
            if (!currentData) return;
            
            if (activeTab === 'daily') {
                renderDailyView();
            } else {
                renderNotificationsView();
            }
        }

        function renderDailyView() {
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            let html = '';
            
            days.forEach(day => {
                const dayTasks = currentData.dailyBreakdown[day];
                const dayName = day.charAt(0).toUpperCase() + day.slice(1);
                
                html += `
                    <div class="day-section">
                        <div class="day-header">${dayName} (${dayTasks.length} tasks)</div>
                `;
                
                if (dayTasks.length === 0) {
                    html += '<p style="color: #666; font-style: italic;">No tasks for this day</p>';
                } else {
                    dayTasks.forEach(task => {
                        html += `
                            <div class="task-item ${task.is_complete ? 'completed' : ''}">
                                <input type="checkbox" class="task-checkbox" ${task.is_complete ? 'checked' : ''} disabled>
                                <div class="task-content">
                                    <div class="task-title">${task.title}</div>
                                    <div class="task-meta">
                                        ${task.description ? task.description + ' • ' : ''}
                                        ${task.reminderFormatted ? 'Reminder: ' + task.reminderFormatted + ' • ' : ''}
                                        Type: ${task.task_type}
                                        ${task.hasSubtasks ? ' • Has subtasks' : ''}
                                        ${task.isSubtask ? ' • Subtask' : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
            });
            
            document.getElementById('daily-content').innerHTML = html;
        }

        function renderNotificationsView() {
            let html = '';
            
            if (currentData.notificationBreakdown.length === 0) {
                html = '<p style="color: #666; font-style: italic;">No notifications scheduled for this week</p>';
            } else {
                currentData.notificationBreakdown.forEach(notification => {
                    html += `
                        <div class="notification-item">
                            <div class="notification-time">
                                ${notification.dateFormatted} at ${notification.time}
                            </div>
                    `;
                    
                    notification.tasks.forEach(task => {
                        html += `
                            <div class="task-item ${task.is_complete ? 'completed' : ''}">
                                <input type="checkbox" class="task-checkbox" ${task.is_complete ? 'checked' : ''} disabled>
                                <div class="task-content">
                                    <div class="task-title">${task.title}</div>
                                    <div class="task-meta">
                                        ${task.taskDateFormatted ? 'Due: ' + task.taskDateFormatted + ' • ' : ''}
                                        ${task.description || ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                });
            }
            
            document.getElementById('notifications-content').innerHTML = html;
        }

        function showTab(tabName) {
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide content
            document.getElementById('daily-content').style.display = tabName === 'daily' ? 'block' : 'none';
            document.getElementById('notifications-content').style.display = tabName === 'notifications' ? 'block' : 'none';
            
            activeTab = tabName;
            renderContent();
        }
    </script>
</body>
</html>
